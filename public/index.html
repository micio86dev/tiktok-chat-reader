<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikTok Live Quiz</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Dependencies -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
  <div id="app">
    <!-- Header -->
    <header>
      <h1>TikTok Live Quiz</h1>
      <p class="subtitle">Scrivi <span class="highlight">?</span> seguito dal numero della risposta (es. <span
          class="highlight">?1</span>)</p>
    </header>

    <main>
      <!-- Quiz Area -->
      <div class="quiz-container">
        <!-- Timer -->
        <div class="timer">{{ timer }}</div>

        <!-- Question -->
        <h2 class="question" v-if="currentQuestion">{{ currentQuestion }}</h2>
        <h2 class="question" v-else>In attesa della prossima domanda...</h2>

        <!-- Options -->
        <div class="options-grid" v-if="options.length > 0">
          <div class="option-card" v-for="(opt, index) in options" :key="index">
            <div class="option-index">?{{ index + 1 }}</div>
            <div class="option-text-container">
              <span>{{ opt }}</span>
              <div class="option-count" v-if="answerCounts && answerCounts['?' + (index + 1)]">
                {{ answerCounts['?' + (index + 1)] }} voti
              </div>
            </div>
          </div>
        </div>

        <!-- Stats Overlay -->
        <div class="stats-overlay" v-if="stats">
          <div class="stats-content">
            <h3 class="stats-title">Risultati</h3>
            <div class="stat-item">
              <span>Totale Risposte:</span>
              <span class="highlight">{{ stats.total }}</span>
            </div>
            <div class="stat-item">
              <span>Corrette:</span>
              <span class="highlight">{{ stats.correctCount }}</span>
            </div>
            <div class="stat-item">
              <span>Precisione:</span>
              <span class="highlight">{{ stats.percentCorrect }}%</span>
            </div>

            <!-- Leaderboard -->
            <div class="leaderboard" v-if="stats.winners && stats.winners.length > 0">
              <h4>üèÜ Top Risposte Corrette</h4>
              <div class="winners-list">
                <div class="winner-item" v-for="(winner, index) in stats.winners" :key="index">
                  <span class="winner-rank">#{{ index + 1 }}</span>
                  <img :src="winner.avatar || 'https://via.placeholder.com/32'" class="winner-avatar" alt="Avatar">
                  <span class="winner-name">{{ winner.nickname }}</span>
                </div>
              </div>
            </div>
            <!-- Question Stats Breakdown -->
            <div class="question-stats-container" v-if="stats.questionStats && stats.questionStats.length > 0">
              <h4>üìä Dettaglio Domande</h4>
              <div class="questions-list">
                <div class="question-stat-item" v-for="(qStat, index) in stats.questionStats" :key="index">
                  <div class="qs-header">
                    <span class="qs-id">#{{ index + 1 }}</span>
                    <span class="qs-text">{{ qStat.text }}</span>
                  </div>
                  <div class="qs-details">
                    <div class="qs-answer">
                      ‚úÖ {{ qStat.correctAnswer }}
                    </div>
                    <div class="qs-metrics">
                      <span class="qs-metric highlight">{{ qStat.percentCorrect }}%</span>
                      <span class="qs-metric-label">({{ qStat.correctCount }}/{{ qStat.totalAnswers }})</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="no-winners" v-else-if="stats.winners">
              Nessuna risposta corretta üò¢
            </div>

            <!-- Restart Button -->
            <button class="restart-btn" @click="resetQuiz">
              üîÑ Nuovo Quiz
            </button>
          </div>
        </div>
      </div>

      <!-- Chat Feed -->
      <div class="chat-container">
        <div class="chat-header">
          <div class="live-indicator"></div>
          Live Chat
        </div>
        <div class="chat-messages" ref="chatContainer">
          <div v-for="(msg, index) in messages" :key="index" class="chat-message"
            :class="{ 'gift-message': msg.type === 'gift' }">
            <img :src="msg.avatar || 'https://via.placeholder.com/32'" class="avatar" alt="Avatar">
            <div class="chat-content" :class="{ 'gift-content': msg.type === 'gift' }">
              <div class="nickname">{{ msg.nickname }}</div>
              <div v-if="msg.type === 'chat'">{{ msg.text }}</div>
              <div v-else-if="msg.type === 'gift'">üéÅ Ha inviato {{ msg.gift }}!</div>
              <div v-else>{{ JSON.stringify(msg.data) }}</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- App Logic -->
  <script src="app.js"></script>
</body>

</html>